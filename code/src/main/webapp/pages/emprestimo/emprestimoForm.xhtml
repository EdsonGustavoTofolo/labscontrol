<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:labs="http://java.sun.com/jsf/composite/labscontrol">
<ui:decorate template="../template/padrao.xhtml">
    <ui:define name="botoesParaForm">
        <p:panelGrid columns="2">
            <p:commandButton process="@this" value="#{form.novo}" action="#{emprestimoController.reset}" update="@form" immediate="true"
                             icon="ui-icon-plus" style="float: left"/>

            <p:commandButton value="#{form.pesquisa}" action="/pages/emprestimo/emprestimoSearch.xhtml?faces-redirect=true"
                             immediate="true" ajax="false" style="float: left"
                             icon="ui-icon ui-icon-search"/>
        </p:panelGrid>
    </ui:define>

    <ui:define name="titulo">
        <h:outputText value="#{form.emprestimo}"/>
    </ui:define>

    <ui:define name="conteudo">
        <p:fieldset legend="#{form.cabecalho}" toggleable="true">
            <p:panelGrid columns="2">
                <h:outputLabel for="usuario" value="#{form.usuario}" />
                <p:inputText id="usuario" value="#{emprestimoController.entity.usuario.nome}" disabled="true"/>

                <h:outputLabel for="otherUsuario" value="#{form.usuario}*" />
                <p:inputText id="otherUsuario" value="#{emprestimoController.entity.outroUsuario}" required="true" requiredMessage="#{msg.campoObrigatorio}" />

                <h:outputLabel value="#{form.data}*" />
                <p:calendar value="#{emprestimoController.entity.data}" pattern="dd/MM/yyyy" mask="true"
                            locale="pt_BR" navigator="true" showButtonPanel="true" size="10" showOn="button"/>

                <h:outputLabel value="#{form.obs}"/>
                <p:inputText value="#{emprestimoController.entity.observacao}" size="60" maxlength="255"/>
            </p:panelGrid>
        </p:fieldset>
        <p:fieldset legend="#{form.itens}" toggleable="true">
            <p:panelGrid columns="2">
                <h:outputLabel value="#{form.tipo}"/>
                <p:selectOneRadio id="tipo" value="#{emprestimoController.tipo}">
                    <f:selectItem itemLabel="#{form.materialDeConsumo}" itemValue="M" />
                    <f:selectItem itemLabel="#{form.equipamento}" itemValue="E" />
                    <p:ajax event="change" update="materialDeConsumo, equipamento, qtdEstoque" global="false"/>
                </p:selectOneRadio>

                <h:outputLabel value="#{form.materialDeConsumo}" for="materialDeConsumo"/>
                <p:autoComplete value="#{emprestimoController.materialDeConsumo}"
                                completeMethod="#{emprestimoController.completeMaterialDeConsumo}"
                                converter="#{materialDeConsumoConverter}"
                                label="#{form.materialDeConsumo}" id="materialDeConsumo" var="materialDeConsumo"
                                itemLabel="#{materialDeConsumo.nome}" itemValue="#{materialDeConsumo}"
                                dropdown="true" forceSelection="true" size="60"
                                disabled="#{!emprestimoController.tipo.equals('M')}">
                    <p:ajax event="itemSelect" listener="#{emprestimoController.onItemSelect}" update="qtdEstoque" />
                </p:autoComplete>

                <h:outputLabel value="#{form.quantidadeEmEstoque}"/>
                <h:outputText id="qtdEstoque" value="#{emprestimoController.qtdEstoque}"/>

                <h:outputLabel value="#{form.equipamento}" for="equipamento"/>
                <p:autoComplete value="#{emprestimoController.equipamento}"
                                completeMethod="#{emprestimoController.completeEquipamento}"
                                converter="#{equipamentoConverter}"
                                label="#{form.equipamento}" id="equipamento" var="equipamento"
                                itemLabel="#{equipamento.nome}" itemValue="#{equipamento}"
                                dropdown="true" forceSelection="true" size="60"
                                disabled="#{!emprestimoController.tipo.equals('E')}"
                                placeholder="#{form.placeHolderEquipamentoEmprestimo}">
                    <p:column>
                        <h:outputText value="#{equipamento.nome}"/>
                    </p:column>
                    <p:column>
                        <h:outputText value="#{equipamento.patrimonio}"/>
                    </p:column>
                </p:autoComplete>

                <h:outputLabel value="#{form.quantidade}"/>
                <p:inputText value="#{emprestimoController.quantidade}">
                    <f:convertNumber locale="pt_BR" pattern="#,##0.00" />
                </p:inputText>

                <f:facet name="footer">
                    <p:commandButton value="#{form.adicionar}" action="#{emprestimoController.addItem}" ajax="true"
                                     update="form" process="@form"/>
                </f:facet>
            </p:panelGrid>

            <p:panelGrid columns="1">
                <p:dataTable value="#{emprestimoController.entity.emprestimoItens}" var="objeto" emptyMessage="#{form.nenhumRegistroEncontrado}"
                             paginator="true" rows="5" paginatorPosition="bottom" id="tableItens" editable="true">
                    <p:column headerText="#{form.item}">
                        <h:outputText value="#{objeto.equipamento != null ? objeto.equipamento : objeto.materialDeConsumo}"/>
                    </p:column>
                    <p:column headerText="#{form.quantidade}">
                        <h:outputText value="#{objeto.quantidade}">
                            <f:convertNumber locale="pt_BR" pattern="#,##0.00" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{form.acoes}" styleClass="columnAcoes">
                        <p:commandButton icon="ui-icon-trash" action="#{emprestimoController.excluirItem(objeto)}" process="@this" update="tableItens" title="#{form.excluir}"/>
                    </p:column>
                </p:dataTable>
            </p:panelGrid>
        </p:fieldset>
    </ui:define>

    <ui:define name="rodape">
        <labs:commandButtonForm update="@form" controller="#{emprestimoController}"/>
    </ui:define>

    <ui:define name="foraDoForm">
        <labs:confirmExclusaoSimples update=":form" action="#{emprestimoController.deleteFromForm}"/>
    </ui:define>
</ui:decorate>
</html>
